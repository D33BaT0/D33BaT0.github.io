<!DOCTYPE html>
<html lang="zh-CN">
    <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>Crypto:P2DPI (450pts ,8 solves) - D-CTF 21-22 - Hao Jiang</title>
  
    <link rel="shortcut icon" href="/img/favicon.jpg">
  
  

  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="always"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">deebato&#39;s blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item" href="/tags">Tags</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item" href="/something">Something</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/D33BaT0" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/ctf/">ctf</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>February</span>
            <span>14,</span>
            <span>2022</span>
        </div>
        

        <h2 class="title">Crypto:P2DPI (450pts ,8 solves) - D-CTF 21-22</h2>
    </div>

    <div class="divider"></div>

    <div class="content">
        <p>a good challenge in D-CTF 21-22. crypt 4 fun!</p>
<p>We try to search for relevant information about <a target="_blank" rel="noopener" href="https://eprint.iacr.org/2021/789.pdf">P2DPI</a> , and find a <a target="_blank" rel="noopener" href="https://github.com/Ephvuln/P2DPI_Attack">paper</a> in Github(The author is the author of this chal).</p>
<h4 id="Main-Part"><a href="#Main-Part" class="headerlink" title="Main Part:"></a>Main Part:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''''''</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SR_Oracle</span>():</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,g,h</span>):</span><br><span class="line">		self.g = g</span><br><span class="line">		self.h = h</span><br><span class="line">		self.k_sr = bytes_to_int(get_random_bytes(<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">compute_intermediate_rule</span>(<span class="params">self,Ri</span>):</span><br><span class="line">		<span class="keyword">return</span> Ri*self.k_sr</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">compute_obfuscated_tokens</span>(<span class="params">self,ti_list</span>):</span><br><span class="line">		Ti_list=[]</span><br><span class="line">		c = randint(<span class="number">0</span>,<span class="number">2</span>**<span class="number">32</span>)</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ti_list)):</span><br><span class="line">			encrypted = int_to_bytes(self._encrypt(ti_list[i]).x)</span><br><span class="line">			Ti_list.append(H2(c+i,encrypted))</span><br><span class="line">		<span class="keyword">return</span> (c,Ti_list)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">_encrypt</span>(<span class="params">self,msg</span>):</span><br><span class="line">		<span class="keyword">return</span> (g*bytes_to_int(H1(msg))+h)*self.k_sr    </span><br><span class="line"><span class="string">''''''</span></span><br><span class="line">			<span class="keyword">if</span> i == <span class="string">'1'</span>:</span><br><span class="line">				n-=<span class="number">1</span></span><br><span class="line">				<span class="keyword">if</span> n &lt; <span class="number">1</span>:</span><br><span class="line">					exit()</span><br><span class="line">				R = <span class="built_in">input</span>().strip()</span><br><span class="line">				Rinit = R.encode(<span class="string">'utf-8'</span>) <span class="comment"># 2lazy2compress</span></span><br><span class="line">				R = R.split(<span class="string">' '</span>)<span class="comment"># 给R点</span></span><br><span class="line">				R = ECC.EccPoint(<span class="built_in">int</span>(R[<span class="number">0</span>],<span class="number">16</span>),<span class="built_in">int</span>(R[<span class="number">1</span>],<span class="number">16</span>))</span><br><span class="line">				sig = b64.b64decode(<span class="built_in">input</span>().strip())<span class="comment"># 对Rinit进行签名</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> R == g <span class="keyword">or</span> R == h:</span><br><span class="line">					<span class="built_in">print</span>(<span class="string">"Rule entropy too small."</span>)</span><br><span class="line">					exit()</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> <span class="keyword">not</span> ver.verify(sig,Rinit):</span><br><span class="line">					exit()</span><br><span class="line"></span><br><span class="line">				s1 = SR.compute_intermediate_rule(R)</span><br><span class="line">				<span class="built_in">print</span>(<span class="built_in">hex</span>(s1.x)[<span class="number">2</span>:],<span class="built_in">hex</span>(s1.y)[<span class="number">2</span>:])</span><br><span class="line">             <span class="keyword">elif</span> i == <span class="string">'2'</span>:</span><br><span class="line">				<span class="keyword">if</span> n_traf:</span><br><span class="line">					n_traf = <span class="literal">False</span> </span><br><span class="line">					c,Ti=SR.compute_obfuscated_tokens(tokenize(secure_message))</span><br><span class="line">					<span class="built_in">print</span>(<span class="built_in">str</span>(c)+<span class="string">'|'</span>,end=<span class="string">''</span>)</span><br><span class="line">					<span class="built_in">print</span>(b64.b64encode(<span class="string">b''</span>.join(Ti)).decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>

<p>choice 1: to encrypt something by <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.048ex;" xmlns="http://www.w3.org/2000/svg" width="5.592ex" height="1.618ex" role="img" focusable="false" viewBox="0 -694 2471.4 715"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(1212.2,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path></g><g data-mml-node="mi" transform="translate(1712.4,0)"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path></g></g></g></svg></mjx-container> , but <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.048ex;" xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="1.593ex" role="img" focusable="false" viewBox="0 -683 759 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path></g></g></g></svg></mjx-container> can’t be <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.079ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 477 647"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g></g></g></svg></mjx-container> or <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.303ex" height="1.595ex" role="img" focusable="false" viewBox="0 -694 576 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></svg></mjx-container> . Also , you should sign the point.</p>
<p>choice 2: to encrypt <code>secure message</code> by <code>compute_obfuscated_tokens</code></p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution:"></a>Solution:</h4><p>In this task,we act as a MB. And in this <a target="_blank" rel="noopener" href="https://github.com/Ephvuln/P2DPI_Attack">paper</a> , we can see here( 3.3 Exhaustive message search vulnerability ).</p>
<p> <img src="https://d33b4t0-1304588131.cos.ap-nanjing.myqcloud.com/1.png" alt="image-20220213221849699"> </p>
<p>And find you can become an <code>SR</code> in a sense to encrypt <code>msg</code> without getting sk (k_SR) .</p>
<p>The implication is that you can do an <strong>MITM(man-in-the-middle)</strong> attack here.</p>
<p>That’s the 1st step what you should do.</p>
<p>The next step is how to decrypt this token. We can find that if the <code>secure message</code> never changes , we just need to get a set of data.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''''''</span></span><br><span class="line">IP = <span class="string">"35.246.134.224"</span></span><br><span class="line">port = <span class="number">32079</span></span><br><span class="line">io = connect(IP, port)</span><br><span class="line">io.recvuntil(<span class="string">b"Hello MiddleBox. Here is my g and h:\r\n"</span>)</span><br><span class="line">data = io.recvline()</span><br><span class="line">data = data.decode().strip().split()</span><br><span class="line">g = (<span class="built_in">int</span>(data[<span class="number">0</span>], <span class="number">16</span>), <span class="built_in">int</span>(data[<span class="number">1</span>], <span class="number">16</span>))</span><br><span class="line">data = io.recvline()</span><br><span class="line">data = data.decode().split()</span><br><span class="line">h = (<span class="built_in">int</span>(data[<span class="number">0</span>], <span class="number">16</span>), <span class="built_in">int</span>(data[<span class="number">1</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">k0 = <span class="number">233333</span></span><br><span class="line"></span><br><span class="line">G = ECC.EccPoint(g[<span class="number">0</span>], g[<span class="number">1</span>])</span><br><span class="line">H = ECC.EccPoint(h[<span class="number">0</span>], h[<span class="number">1</span>])</span><br><span class="line">io.recvuntil(<span class="string">b"2. Get traffic\r\n"</span>)</span><br><span class="line">P1 = k0 * G</span><br><span class="line">io.sendline(<span class="string">b"1"</span>)</span><br><span class="line">io.sendline((<span class="built_in">hex</span>(P1.x)[<span class="number">2</span>:] + <span class="string">" "</span> + <span class="built_in">hex</span>(P1.y)[<span class="number">2</span>:]).encode())</span><br><span class="line">sig = ver.sign((<span class="built_in">hex</span>(P1.x)[<span class="number">2</span>:] + <span class="string">" "</span> + <span class="built_in">hex</span>(P1.y)[<span class="number">2</span>:]).encode())</span><br><span class="line">io.sendline(b64.b64encode(sig))</span><br><span class="line">data = io.recvline()</span><br><span class="line">data = data.decode().split()</span><br><span class="line">kG = ECC.EccPoint(<span class="built_in">int</span>(data[<span class="number">0</span>], <span class="number">16</span>), <span class="built_in">int</span>(data[<span class="number">1</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b"2. Get traffic\r\n"</span>)</span><br><span class="line">P2 = k0 * H</span><br><span class="line">io.sendline(<span class="string">b"1"</span>)</span><br><span class="line">io.sendline((<span class="built_in">hex</span>(P2.x)[<span class="number">2</span>:] + <span class="string">" "</span> + <span class="built_in">hex</span>(P2.y)[<span class="number">2</span>:]).encode())</span><br><span class="line">sig = ver.sign((<span class="built_in">hex</span>(P2.x)[<span class="number">2</span>:] + <span class="string">" "</span> + <span class="built_in">hex</span>(P2.y)[<span class="number">2</span>:]).encode())</span><br><span class="line">io.sendline(b64.b64encode(sig))</span><br><span class="line">data = io.recvline()</span><br><span class="line">data = data.decode().split()</span><br><span class="line">kH = ECC.EccPoint(<span class="built_in">int</span>(data[<span class="number">0</span>], <span class="number">16</span>), <span class="built_in">int</span>(data[<span class="number">1</span>], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">kG = <span class="built_in">pow</span>(k0, n - <span class="number">2</span>, n) * kG</span><br><span class="line">kH = <span class="built_in">pow</span>(k0, n - <span class="number">2</span>, n) * kH</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"kG.x ="</span>, kG.x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"kG.y ="</span>, kG.y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"kH.x ="</span>, kH.x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"kH.y ="</span>, kH.y)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b"2. Get traffic\r\n"</span>)</span><br><span class="line">io.sendline(<span class="string">b"2"</span>)</span><br><span class="line">data = io.recvline()</span><br><span class="line">data=data.decode().split(<span class="string">'|'</span>)</span><br><span class="line">c=<span class="built_in">int</span>(data[<span class="number">0</span>])</span><br><span class="line">T=b64.b64decode(data[<span class="number">1</span>].encode())</span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure>



<p>Then, let’s analyse the <code>tokenize</code> &amp; <code>compute_obfuscated_tokens</code>.</p>
<p>We find that <code>tokenize</code> is so weak if you can know a block in it. and it’s expressed in paper.</p>
<p><img src="https://d33b4t0-1304588131.cos.ap-nanjing.myqcloud.com/2.png" alt="image-20220213223150492"></p>
<p>The flag’s format is <code>CTF{sha256}</code> . So we can get half a token block. But we don’t know where the index of the flag is. It needs brute-force.( Only hexdigist(lower) * 4 * length(Ti) ).</p>
<p><img src="https://d33b4t0-1304588131.cos.ap-nanjing.myqcloud.com/3.png" alt="image-20220213223103151"></p>
<h4 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix:"></a>Appendix:</h4><p>This question is really interesting. Thanks to <code>Ephvuln</code> a lot !!! </p>
<p>I am honored to help him revise the blasting complexity of ASCII in the paper</p>

    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by Hao Jiang, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/ctf/" class="tag">#ctf</a><a href="/tags/cryptography/" class="tag">#cryptography</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/D3CTF2022equivalent/" class="next">
            <div>
                <div class="text">
                    <p class="label">Next</p>
                    <h3 class="title">Crypto:equivalent - Ant x D^3 CTF 2022</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/DiceCTF_writeups/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">WriteUps of DiceCTF2022(part crypto)</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/something" class="item">Something</a>
                
                <a href="/about" class="item">About</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/D33BaT0" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://twitter.com/De3bato" class="item">Twitter</a>
                
                <a target="_blank" rel="noopener" href="https://space.bilibili.com/324843873" class="item">Bilibili</a>
                
                <a href="mailto:2546664446@qq.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2024 Hao Jiang<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        <br>
        <span class="footer-extra-description">Life is a struggle,but you can fight against it...</span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>